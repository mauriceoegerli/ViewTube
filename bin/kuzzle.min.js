/**
 * Skipped minification because the original files appears to be already minified.
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*! Kuzzle javascript SDK version 6.1.4 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["kuzzle-sdk"]=t():e.KuzzleSDK=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._kuzzle=t,this._name=r}var t,n,o;return t=e,(n=[{key:"query",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.controller=e.controller||this.name,this._kuzzle.query(e,t)}},{key:"kuzzle",get:function(){return this._kuzzle}},{key:"name",get:function(){return this._name}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._kuzzle=t,this._request=r,this._response=o,this._options=n,this._controller=r.controller,this._searchAction="search",this._scrollAction="scroll",this.aggregations=o.aggregations,this.hits=o.hits||[],this.fetched=this.hits.length,this.total=o.total||0}var t,n,o;return t=e,(n=[{key:"next",value:function(){var e=this;if(this.fetched>=this.total)return Promise.resolve(null);if(this._request.scroll)return this._kuzzle.query({controller:this._request.controller,action:this._scrollAction,scroll:this._request.scroll,scrollId:this._response.scrollId},this._options).then(function(t){return e._buildNextSearchResult(t)});if(this._request.size&&this._request.body.sort){var t=Object.assign({},this._request,{action:this._searchAction}),r=this._response.hits[this._response.hits.length-1];t.body.search_after=[];for(var n=0,o=this._request.body.sort;n<o.length;n++){var i=o[n],u="string"==typeof i?i:Object.keys(i)[0],s="_uid"===u?this._request.collection+"#"+r._id:this._get(r._source,u.split("."));t.body.search_after.push(s)}return this._kuzzle.query(t,this._options).then(function(t){return e._buildNextSearchResult(t)})}if(this._request.size)return this._request.from>=this._response.total?Promise.resolve(null):this._kuzzle.query(Object.assign({},this._request,{action:this._searchAction,from:this.fetched}),this._options).then(function(t){return e._buildNextSearchResult(t)});throw new Error("Unable to retrieve next results from search: missing scrollId, from/sort, or from/size params")}},{key:"_get",value:function(e,t){if(!e)return e;if(1===t.length)return e[t[0]];var r=t.shift();return this._get(e[r],t)}},{key:"_buildNextSearchResult",value:function(e){var t=new this.constructor(this._kuzzle,this._request,this._options,e.result);return t.fetched+=this.fetched,t}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o(this,e),this.fn=t,this.once=r},u=function(){function e(){o(this,e),this._events={}}var t,u,s;return t=e,(u=[{key:"_exists",value:function(e,t){return Boolean(e.find(function(e){return e.fn===t}))}},{key:"listeners",value:function(e){return void 0===this._events[e]?[]:this._events[e].map(function(e){return e.fn})}},{key:"addListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return this;var o=r(t);if("function"!==o)throw new Error("Invalid listener type: expected a function, got a ".concat(o));return void 0===this._events[e]&&(this._events[e]=[]),this._exists(this._events[e],t)||this._events[e].push(new i(t,n)),this}},{key:"on",value:function(e,t){return this.addListener(e,t)}},{key:"prependListener",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&t?(void 0===this._events[e]&&(this._events[e]=[]),this._exists(this._events[e],t)||(this._events[e]=[new i(t,r)].concat(this._events[e])),this):this}},{key:"addOnceListener",value:function(e,t){return this.addListener(e,t,!0)}},{key:"once",value:function(e,t){return this.addOnceListener(e,t)}},{key:"prependOnceListener",value:function(e,t){return this.prependListener(e,t,!0)}},{key:"removeListener",value:function(e,t){var r=this._events[e];if(!r||!r.length)return this;var n=r.findIndex(function(e){return e.fn===t});return-1!==n&&r.splice(n,1),0===r.length&&delete this._events[e],this}},{key:"removeAllListeners",value:function(e){return e?delete this._events[e]:this._events={},this}},{key:"emit",value:function(e){var t=this._events[e];if(void 0===t)return!1;for(var r=[],n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];for(var u=0;u<t.length;u++){var s=t[u];s.fn.apply(s,o),s.once&&r.push(s.fn)}for(var l=0;l<r.length;l++){var c=r[l];this.removeListener(e,c)}return!0}},{key:"eventNames",value:function(){return Object.keys(this._events)}},{key:"listenerCount",value:function(e){return this._events[e]&&this._events[e].length||0}}])&&n(t.prototype,u),s&&n(t,s),e}();e.exports=u},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._kuzzle=t,this._id=r,this.content=n}var t,n,o;return t=e,(n=[{key:"getProfiles",value:function(){return this.profileIds&&0!==this.profileIds.length?this.kuzzle.security.mGetProfiles(this.profileIds):Promise.resolve([])}},{key:"kuzzle",get:function(){return this._kuzzle}},{key:"profileIds",get:function(){return this.content.profileIds||[]}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l,c,a,f=r(30),d=r(7),h=r(2),p=function(e){function t(e){var r,o,s,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,s=i(t).call(this),r=!s||"object"!==n(s)&&"function"!=typeof s?u(o):s,l=e,c="number"==typeof f.port?f.port:7512,a="boolean"==typeof f.sslConnection&&f.sslConnection,r.id=d(),r.state="offline",Object.keys(f).forEach(function(e){r.hasOwnProperty(e)&&Object.getOwnPropertyDescriptor(u(r),e).writable&&(r[e]=f[e])}),r}var r,p,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,h),r=t,(p=[{key:"connect",value:function(){throw new Error('Method "connect" is not implemented')}},{key:"send",value:function(){throw new Error('Method "send" is not implemented')}},{key:"clientConnected",value:function(e,t){this.state=e||"ready",this.emit(t?"reconnect":"connect")}},{key:"close",value:function(){this.state="offline"}},{key:"query",value:function(e){var t=this;return this.isReady()?new Promise(function(r,n){t.once(e.requestId,function(o){if(o.error){var i=new f(o.error);return t.emit("queryError",i,e),"logout"!==e.action&&"Token expired"===i.message&&t.emit("tokenExpired"),n(i)}return r(o)}),t.send(e)}):(this.emit("discarded",e),Promise.reject(new Error("Unable to execute request: not connected to a Kuzzle server.\nDiscarded request: ".concat(JSON.stringify(e)))))}},{key:"isReady",value:function(){return"ready"===this.state}},{key:"host",get:function(){return l}},{key:"port",get:function(){return c}},{key:"ssl",get:function(){return a}},{key:"connected",get:function(){return"online"===this.state}}])&&o(r.prototype,p),y&&o(r,y),t}();e.exports=p},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._kuzzle=t,this._id=r,this.controllers=n}var t,n,o;return t=e,(n=[{key:"kuzzle",get:function(){return this._kuzzle}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._kuzzle=t,this._id=r,this.policies=n}var t,n,o;return t=e,(n=[{key:"getRoles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.policies&&0!==this.policies.length?this.kuzzle.security.mGetRoles(this.policies.map(function(e){return e.roleId}),e):Promise.resolve([])}},{key:"kuzzle",get:function(){return this._kuzzle}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t){e.exports=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(4),a=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=i(this,s(t).call(this,e,n)))._autoReconnect="boolean"!=typeof n.autoReconnect||n.autoReconnect,r._reconnectionDelay="number"==typeof n.reconnectionDelay?n.reconnectionDelay:1e3,r.wasConnected=!1,r.stopRetryingToConnect=!1,r.retrying=!1,r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),r=t,(n=[{key:"connect",value:function(){this.state="connecting"}},{key:"clientConnected",value:function(){u(s(t.prototype),"clientConnected",this).call(this,"connected",this.wasConnected),this.state="connected",this.wasConnected=!0,this.stopRetryingToConnect=!1}},{key:"clientDisconnected",value:function(){this.emit("disconnect")}},{key:"clientNetworkError",value:function(e){var t=this;this.state="offline";var r=new Error("Unable to connect to kuzzle server at ".concat(this.host,":").concat(this.port));r.internal=e,this.emit("networkError",r),!this.autoReconnect||this.retrying||this.stopRetryingToConnect?this.emit("disconnect"):(this.retrying=!0,setTimeout(function(){t.retrying=!1,t.connect(t.host).catch(function(e){return t.clientNetworkError(e)})},this.reconnectionDelay))}},{key:"isReady",value:function(){return"connected"===this.state}},{key:"autoReconnect",get:function(){return this._autoReconnect}},{key:"reconnectionDelay",get:function(){return this._reconnectionDelay}}])&&o(r.prototype,n),a&&o(r,a),t}();e.exports=a},function(e,t,r){var n=r(10),o=r(28),i=o.Http,u=o.WebSocket,s=o.SocketIO,l=r(0),c=r(4),a=r(2);e.exports={Kuzzle:n,Http:i,WebSocket:u,SocketIO:s,BaseController:l,KuzzleAbstractProtocol:c,KuzzleEventEmitter:a}},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=r(2),f=r(11),d=r(13),h=r(14),p=r(16),y=r(18),b=r(19),v=r(21),m=r(22),_=r(26),g=r(0),w=r(7),z=r(27),E=["connected","discarded","disconnected","loginAttempt","networkError","offlineQueuePush","offlineQueuePop","queryError","reconnected","tokenExpired"],T=function(e){function t(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=i(this,l(t).call(this)),null==e)throw new Error('"protocol" argument missing');for(var s=0,c=["addListener","isReady","query"];s<c.length;s++){var a=c[s];if("function"!=typeof e[a])throw new Error('Protocol instance must implement a "'.concat(a,'" method'))}return r.protocol=e,r._protectedEvents={connected:{},error:{},disconnected:{},reconnected:{},tokenExpired:{},loginAttempt:{}},r.autoResubscribe="boolean"!=typeof o.autoResubscribe||o.autoResubscribe,r.eventTimeout="number"==typeof o.eventTimeout?o.eventTimeout:200,r.sdkVersion="6.1.4",r.volatile="object"===n(o.volatile)?o.volatile:{},r.useController(f,"auth"),r.useController(d,"bulk"),r.useController(h,"collection"),r.useController(p,"document"),r.useController(y,"index"),r.useController(_,"ms"),r.useController(b,"realtime"),r.useController(m,"security"),r.useController(v,"server"),r._autoQueue="boolean"==typeof o.autoQueue&&o.autoQueue,r._autoReplay="boolean"==typeof o.autoReplay&&o.autoReplay,r._offlineQueue=[],r._offlineQueueLoader="function"==typeof o.offlineQueueLoader?o.offlineQueueLoader:null,r._queueFilter="function"==typeof o.queueFilter?o.queueFilter:null,r._queueMaxSize="number"==typeof o.queueMaxSize?o.queueMaxSize:500,r._queueTTL="number"==typeof o.queueTTL?o.queueTTL:12e4,"auto"===o.offlineMode&&(r._autoQueue=!0,r._autoReplay=!0),r.queuing=!1,r.replayInterval=10,r._jwt=void 0,i(r,z(u(r),{seal:!0,name:"kuzzle",exposeApi:!0}))}var r,T,O;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,a),r=t,(T=[{key:"emit",value:function(e){var r,n=Date.now(),o=this._protectedEvents[e];if(o){if(o.lastEmitted&&o.lastEmitted>n-this.eventTimeout)return!1;o.lastEmitted=n}for(var i=arguments.length,u=new Array(i>1?i-1:0),c=1;c<i;c++)u[c-1]=arguments[c];(r=s(l(t.prototype),"emit",this)).call.apply(r,[this,e].concat(u))}},{key:"connect",value:function(){var e=this;return this.protocol.isReady()?Promise.resolve():(this.autoQueue&&this.startQueuing(),this.protocol.addListener("queryError",function(t,r){return e.emit("queryError",t,r)}),this.protocol.addListener("tokenExpired",function(){e.auth.authenticationToken=null,e.emit("tokenExpired")}),this.protocol.addListener("connect",function(){e.autoQueue&&e.stopQueuing(),e.autoReplay&&e.playQueue(),e.emit("connected")}),this.protocol.addListener("networkError",function(t){e.autoQueue&&e.startQueuing(),e.emit("networkError",t)}),this.protocol.addListener("disconnect",function(){e.emit("disconnected")}),this.protocol.addListener("reconnect",function(){if(e.autoQueue&&e.stopQueuing(),e.autoReplay&&e.playQueue(),e.auth.authenticationToken)return e.auth.checkToken().then(function(t){t.valid||(e.auth.authenticationToken=null)}).catch(function(){e.auth.authenticationToken=null}).then(function(){return e.emit("reconnected")});e.emit("reconnected")}),this.protocol.addListener("discarded",function(t){return e.emit("discarded",t)}),this.protocol.connect())}},{key:"addListener",value:function(e,r){if(-1===E.indexOf(e))throw new Error("[".concat(e,"] is not a known event. Known events: ").concat(E.toString()));return s(l(t.prototype),"addListener",this).call(this,e,r)}},{key:"flushQueue",value:function(){return this._offlineQueue=[],this}},{key:"disconnect",value:function(){this.protocol.close()}},{key:"query",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==n(t)||Array.isArray(t))throw new Error("Kuzzle.query: Invalid request: ".concat(JSON.stringify(t)));if("object"!==n(r)||Array.isArray(r))throw new Error('Kuzzle.query: Invalid "options" argument: '.concat(JSON.stringify(r)));if(t.requestId||(t.requestId=w()),t.refresh&&(t.refresh="wait_for"),t.volatile){if("object"!==n(t.volatile)||Array.isArray(t.volatile))throw new Error("Kuzzle.query: Invalid volatile argument received: ".concat(JSON.stringify(t.volatile)))}else t.volatile=this.volatile;for(var o=0,i=Object.keys(this.volatile);o<i.length;o++){var u=i[o];void 0===t.volatile[u]&&(t.volatile[u]=this.volatile[u])}t.volatile.sdkInstanceId=this.protocol.id,t.volatile.sdkVersion=this.sdkVersion,this.auth.authenticateRequest(t);var s=!0;return r&&!1===r.queuable&&(s=!1),this.queueFilter&&(s=s&&this.queueFilter(t)),this.queuing?s?(this._cleanQueue(),this.emit("offlineQueuePush",{request:t}),new Promise(function(r,n){e.offlineQueue.push({resolve:r,reject:n,request:t,ts:Date.now()})})):(this.emit("discarded",{request:t}),Promise.reject(new Error("Unable to execute request: not connected to a Kuzzle server.\nDiscarded request: ".concat(JSON.stringify(t))))):this.protocol.query(t)}},{key:"startQueuing",value:function(){return this.queuing=!0,this}},{key:"stopQueuing",value:function(){return this.queuing=!1,this}},{key:"playQueue",value:function(){return this.protocol.isReady()&&(this._cleanQueue(),this._dequeue()),this}},{key:"useController",value:function(e,t){if(!(e.prototype instanceof g))throw new Error("Controllers must inherits from the BaseController class.");if(!(t&&t.length>0))throw new Error("You must provide a valid accessor.");if(this.__proxy__?this.__proxy__.hasProp(t):this[t])throw new Error("There is already a controller with the accessor '".concat(t,"'. Please use another one."));var r=new e(this);if(!(r.name&&r.name.length>0))throw new Error("Controllers must have a name.");if(r.kuzzle!==this)throw new Error("You must pass the Kuzzle SDK instance to the parent constructor.");return this.__proxy__&&this.__proxy__.registerProp(t),this[t]=r,this}},{key:"_checkPropertyType",value:function(e,t,r){if("array"===t?!Array.isArray(r):n(r)!==t)throw new Error("Expected ".concat(e," to be a ").concat(t,", ").concat(n(r)," received"))}},{key:"_cleanQueue",value:function(){var e=this,t=Date.now(),r=-1;this.queueTTL>0&&(this.offlineQueue.forEach(function(n,o){n.ts<t-e.queueTTL&&(r=o)}),-1!==r&&this.offlineQueue.splice(0,r+1).forEach(function(t){e.emit("offlineQueuePop",t.query)})),this.queueMaxSize>0&&this.offlineQueue.length>this.queueMaxSize&&this.offlineQueue.splice(0,this.offlineQueue.length-this.queueMaxSize).forEach(function(t){e.emit("offlineQueuePop",t.query)})}},{key:"_dequeue",value:function(){var e=this,t={},r=function t(){e.offlineQueue.length>0&&(e.protocol.query(e.offlineQueue[0].request).then(e.offlineQueue[0].resolve).catch(e.offlineQueue[0].reject),e.emit("offlineQueuePop",e.offlineQueue.shift()),setTimeout(function(){t()},Math.max(0,e.replayInterval)))};if(this.offlineQueueLoader){if("function"!=typeof this.offlineQueueLoader)throw new Error("Invalid value for offlineQueueLoader property. Expected: function. Got: "+n(this.offlineQueueLoader));return Promise.resolve().then(function(){return e.offlineQueueLoader()}).then(function(o){if(!Array.isArray(o))throw new Error("Invalid value returned by the offlineQueueLoader function. Expected: array. Got: "+n(o));e._offlineQueue=o.concat(e.offlineQueue).filter(function(e){if(!e.request||void 0===e.request.requestId||!e.request.action||!e.request.controller)throw new Error("Invalid offline queue request. One or more missing properties: requestId, action, controller.");return!t.hasOwnProperty(e.request.requestId)&&(t[e.request.requestId]=!0)}),r()})}r()}},{key:"autoQueue",get:function(){return this._autoQueue},set:function(e){this._checkPropertyType("_autoQueue","boolean",e),this._autoQueue=e}},{key:"autoReconnect",get:function(){return this.protocol.autoReconnect},set:function(e){this._checkPropertyType("autoReconnect","boolean",e),this.protocol.autoReconnect=e}},{key:"autoReplay",get:function(){return this._autoReplay},set:function(e){this._checkPropertyType("_autoReplay","boolean",e),this._autoReplay=e}},{key:"host",get:function(){return this.protocol.host}},{key:"offlineQueue",get:function(){return this._offlineQueue}},{key:"offlineQueueLoader",get:function(){return this._offlineQueueLoader},set:function(e){this._checkPropertyType("_offlineQueueLoader","function",e),this._offlineQueueLoader=e}},{key:"port",get:function(){return this.protocol.port}},{key:"queueFilter",get:function(){return this._queueFilter},set:function(e){this._checkPropertyType("_queueFilter","function",e),this._queueFilter=e}},{key:"queueMaxSize",get:function(){return this._queueMaxSize},set:function(e){this._checkPropertyType("_queueMaxSize","number",e),this._queueMaxSize=e}},{key:"queueTTL",get:function(){return this._queueTTL},set:function(e){this._checkPropertyType("_queueTTL","number",e),this._queueTTL=e}},{key:"reconnectionDelay",get:function(){return this.protocol.reconnectionDelay}},{key:"replayInterval",get:function(){return this._replayInterval},set:function(e){this._checkPropertyType("_replayInterval","number",e),this._replayInterval=e}},{key:"sslConnection",get:function(){return this.protocol.sslConnection}},{key:"authenticated",get:function(){return this.auth.authenticationToken&&!this.auth.authenticationToken.expired}},{key:"jwt",get:function(){return this.auth.authenticationToken?this.auth.authenticationToken.encodedJwt:null},set:function(e){this.auth.authenticationToken=e}},{key:"connected",get:function(){return this.protocol.connected}}])&&o(r.prototype,T),O&&o(r,O),t}();e.exports=T},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(12),c=r(0),a=r(3),f=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=i(this,u(t).call(this,e,"auth")))._authenticationToken=null,r}var r,n,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,c),r=t,(n=[{key:"authenticateRequest",value:function(e){this.authenticationToken&&("auth"!==e.controller||"checkToken"!==e.action&&"login"!==e.action)&&(e.jwt=this.authenticationToken.encodedJwt)}},{key:"checkToken",value:function(e){return void 0===e&&this.authenticationToken&&(e=this.authenticationToken.encodedJwt),this.query({action:"checkToken",body:{token:e}},{queuable:!1}).then(function(e){return e.result})}},{key:"createMyCredentials",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.query({strategy:e,action:"createMyCredentials",body:t},r).then(function(e){return e.result})}},{key:"credentialsExist",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({strategy:e,action:"credentialsExist"},t).then(function(e){return e.result})}},{key:"deleteMyCredentials",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({strategy:e,action:"deleteMyCredentials"},t).then(function(e){return e.result.acknowledged})}},{key:"getCurrentUser",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getCurrentUser"},t).then(function(t){return new a(e.kuzzle,t.result._id,t.result._source)})}},{key:"getMyCredentials",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({strategy:e,action:"getMyCredentials"},t).then(function(e){return e.result})}},{key:"getMyRights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getMyRights"},e).then(function(e){return e.result.hits})}},{key:"getStrategies",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getStrategies"},e).then(function(e){return e.result})}},{key:"login",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"!=typeof e||""===e)throw new Error("Kuzzle.auth.login: strategy is required");var o={strategy:e,expiresIn:n,body:r,action:"login"};return this.query(o,{queuable:!1}).then(function(e){try{t._authenticationToken=new l(e.result.jwt),t.kuzzle.emit("loginAttempt",{success:!0})}catch(e){return Promise.reject(e)}return e.result.jwt}).catch(function(e){throw t.kuzzle.emit("loginAttempt",{success:!1,error:e.message}),e})}},{key:"logout",value:function(){var e=this;return this.query({action:"logout"},{queuable:!1}).then(function(){e._authenticationToken=null})}},{key:"updateMyCredentials",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.query({strategy:e,body:t,action:"updateMyCredentials"},r).then(function(e){return e.result})}},{key:"updateSelf",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({body:e,action:"updateSelf"},r).then(function(e){return new a(t.kuzzle,e.result._id,e.result._source)})}},{key:"validateMyCredentials",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.query({strategy:e,body:t,action:"validateMyCredentials"},r).then(function(e){return e.result})}},{key:"refreshToken",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={action:"refreshToken",expiresIn:t.expiresIn};return this.query(r,t).then(function(t){return e._authenticationToken=new l(t.result.jwt),t.result})}},{key:"authenticationToken",get:function(){return this._authenticationToken},set:function(e){if(null==e)this._authenticationToken=null;else{if("string"!=typeof e)throw new Error("Invalid token argument: ".concat(e));this._authenticationToken=new l(e)}}}])&&o(r.prototype,n),f&&o(r,f),t}();e.exports=f},function(e,t,r){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(n=(u=s.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._encodedJwt=t,this._userId=null,this._expiresAt=null,this._decode()}var t,r,i;return t=e,(r=[{key:"_decode",value:function(){var e,t,r=n(this._encodedJwt.split("."),2)[1];if(!r)throw new Error("Invalid JWT format");try{e=JSON.parse((t=r,Buffer?Buffer.from(t,"base64").toString():atob(t)))}catch(e){throw new Error("Invalid JSON payload for JWT")}this._userId=e._id,this._expiresAt=e.exp}},{key:"encodedJwt",get:function(){return this._encodedJwt}},{key:"userId",get:function(){return this._userId}},{key:"expiresAt",get:function(){return this._expiresAt}},{key:"expired",get:function(){return Date.now()>this.expiresAt}}])&&o(t.prototype,r),i&&o(t,i),e}();e.exports=i},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(0),c=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,u(t).call(this,e,"bulk"))}var r,n,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),r=t,(n=[{key:"import",value:function(e,t){return this.query({action:"import",body:{bulkData:e}},t).then(function(e){return e.result})}}])&&o(r.prototype,n),c&&o(r,c),t}();e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(0),a=r(15),f=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,s(t).call(this,e,"collection"))}var r,n,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),r=t,(n=[{key:"create",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.collection.create: index is required");if(!t)throw new Error("Kuzzle.collection.create: collection is required");return this.query({index:e,collection:t,body:r,action:"create"},n).then(function(e){return e.result})}},{key:"deleteSpecifications",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.collection.deleteSpecifications: index is required");if(!t)throw new Error("Kuzzle.collection.deleteSpecifications: collection is required");return this.query({index:e,collection:t,action:"deleteSpecifications"},r).then(function(e){return e.result})}},{key:"exists",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.collection.exists: index is required");if(!t)throw new Error("Kuzzle.collection.exists: collection is required");return this.query({index:e,collection:t,action:"exists"},r).then(function(e){return e.result})}},{key:"getMapping",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.collection.getMapping: index is required");if(!t)throw new Error("Kuzzle.collection.getMapping: collection is required");return this.query({index:e,collection:t,action:"getMapping"},r).then(function(e){return e.result})}},{key:"getSpecifications",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.collection.getSpecifications: index is required");if(!t)throw new Error("Kuzzle.collection.getSpecifications: collection is required");return this.query({index:e,collection:t,action:"getSpecifications"},r).then(function(e){return e.result})}},{key:"list",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.collection.list: index is required");var r={index:e,action:"list",from:t.from,size:t.size};return delete t.from,delete t.size,this.query(r,t).then(function(e){return e.result})}},{key:"searchSpecifications",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={body:t,action:"searchSpecifications"},o=0,i=["from","size","scroll"];o<i.length;o++){var u=i[o];n[u]=r[u],delete r[u]}return this.query(n,r).then(function(t){return new a(e.kuzzle,n,r,t.result)})}},{key:"truncate",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.collection.truncate: index is required");if(!t)throw new Error("Kuzzle.collection.truncate: collection is required");return this.query({index:e,collection:t,action:"truncate",refresh:r.refresh},r).then(function(e){return e.result})}},{key:"updateMapping",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.collection.updateMapping: index is required");if(!t)throw new Error("Kuzzle.collection.updateMapping: collection is required");return this.query({index:e,collection:t,body:r,action:"updateMapping"},n).then(function(e){return e.result})}},{key:"updateSpecifications",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.collection.updateSpecifications: index is required");if(!t)throw new Error("Kuzzle.collection.updateSpecifications: collection is required");if(!r)throw new Error("Kuzzle.collection.updateSpecifications: specifications are required");var i=o({},e,o({},t,r));return this.query({body:i,action:"updateSpecifications"},n).then(function(r){return r.result[e][t]})}},{key:"validateSpecifications",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.collection.validateSpecifications: index is required");if(!t)throw new Error("Kuzzle.collection.validateSpecifications: collection is required");if(!r)throw new Error("Kuzzle.collection.updateSpecifications: specifications are required");var i=o({},e,o({},t,r));return this.query({body:i,action:"validateSpecifications"},n).then(function(e){return e.result})}}])&&i(r.prototype,n),f&&i(r,f),t}();e.exports=f},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=r(1),l=function(e){function t(e,r,n,u){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=o(this,i(t).call(this,e,r,n,u)))._controller="collection",s._searchAction="searchSpecifications",s._scrollAction="scrollSpecifications",s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,s),t}();e.exports=l},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(0),c=r(17),a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,u(t).call(this,e,"document"))}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),r=t,(n=[{key:"count",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.count: index is required");if(!t)throw new Error("Kuzzle.document.count: collection is required");var o={index:e,collection:t,body:r,action:"count",includeTrash:n.includeTrash};return delete n.includeTrash,this.query(o,n).then(function(e){return e.result.count})}},{key:"create",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!e)throw new Error("Kuzzle.document.create: index is required");if(!t)throw new Error("Kuzzle.document.create: collection is required");if(!r)throw new Error("Kuzzle.document.create: document is required");var i={index:e,collection:t,_id:n,body:r,action:"create",refresh:o.refresh};return delete o.refresh,this.query(i,o).then(function(e){return e.result})}},{key:"createOrReplace",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!e)throw new Error("Kuzzle.document.createOrReplace: index is required");if(!t)throw new Error("Kuzzle.document.createOrReplace: collection is required");if(!r)throw new Error("Kuzzle.document.createOrReplace: _id is required");if(!n)throw new Error("Kuzzle.document.createOrReplace: body is required");var i={index:e,collection:t,_id:r,body:n,action:"createOrReplace",refresh:o.refresh};return delete o.refresh,this.query(i,o).then(function(e){return e.result})}},{key:"delete",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.delete: index is required");if(!t)throw new Error("Kuzzle.document.delete: collection is required");if(!r)throw new Error("Kuzzle.document.delete: _id is required");var o={index:e,collection:t,_id:r,action:"delete",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result._id})}},{key:"deleteByQuery",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.deleteByQuery: index is required");if(!t)throw new Error("Kuzzle.document.deleteByQuery: collection is required");var o={index:e,collection:t,body:r,action:"deleteByQuery",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result.ids})}},{key:"exists",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.get: index is required");if(!t)throw new Error("Kuzzle.document.get: collection is required");if(!r)throw new Error("Kuzzle.document.get: _id is required");var o={index:e,collection:t,_id:r,action:"exists"};return this.query(o,n).then(function(e){return e.result})}},{key:"get",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.get: index is required");if(!t)throw new Error("Kuzzle.document.get: collection is required");if(!r)throw new Error("Kuzzle.document.get: _id is required");var o={index:e,collection:t,_id:r,action:"get",includeTrash:n.includeTrash};return delete n.includeTrash,this.query(o,n).then(function(e){return e.result})}},{key:"mCreate",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.mCreate: index is required");if(!t)throw new Error("Kuzzle.document.mCreate: collection is required");if(!Array.isArray(r))throw new Error("Kuzzle.document.mCreate: documents must be an array");var o={index:e,collection:t,body:{documents:r},action:"mCreate",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result})}},{key:"mCreateOrReplace",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.mCreateOrReplace: index is required");if(!t)throw new Error("Kuzzle.document.mCreateOrReplace: collection is required");if(!Array.isArray(r))throw new Error("Kuzzle.document.mCreateOrReplace: documents must be an array");var o={index:e,collection:t,body:{documents:r},action:"mCreateOrReplace",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result})}},{key:"mDelete",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.mDelete: index is required");if(!t)throw new Error("Kuzzle.document.mDelete: collection is required");if(!Array.isArray(r))throw new Error("Kuzzle.document.mDelete: ids must be an array");var o={index:e,collection:t,body:{ids:r},action:"mDelete",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result})}},{key:"mGet",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.mGet: index is required");if(!t)throw new Error("Kuzzle.document.mGet: collection is required");if(!Array.isArray(r))throw new Error("Kuzzle.document.mGet: ids must be an array");var o={index:e,collection:t,body:{ids:r},action:"mGet",includeTrash:n.includeTrash};return delete n.includeTrash,this.query(o,n).then(function(e){return e.result})}},{key:"mReplace",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.mReplace: index is required");if(!t)throw new Error("Kuzzle.document.mReplace: collection is required");if(!Array.isArray(r))throw new Error("Kuzzle.document.mReplace: documents must be an array");var o={index:e,collection:t,body:{documents:r},action:"mReplace",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result})}},{key:"mUpdate",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.mUpdate: index is required");if(!t)throw new Error("Kuzzle.document.mUpdate: collection is required");if(!Array.isArray(r))throw new Error("Kuzzle.document.mUpdate: documents must be an array");var o={index:e,collection:t,body:{documents:r},action:"mUpdate",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return e.result})}},{key:"replace",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!e)throw new Error("Kuzzle.document.replace: index is required");if(!t)throw new Error("Kuzzle.document.replace: collection is required");if(!r)throw new Error("Kuzzle.document.replace: _id is required");if(!n)throw new Error("Kuzzle.document.replace: body is required");var i={index:e,collection:t,_id:r,body:n,action:"replace",refresh:o.refresh};return delete o.refresh,this.query(i,o).then(function(e){return e.result})}},{key:"search",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.search: index is required");if(!t)throw new Error("Kuzzle.document.search: collection is required");for(var i={index:e,collection:t,body:n,action:"search"},u=0,s=["from","size","scroll","includeTrash"];u<s.length;u++){var l=s[u];i[l]=o[l],delete o[l]}return i.size=i.size||10,i.scroll||i.body.sort||i.from||(i.from=0),this.query(i,o).then(function(e){return new c(r.kuzzle,i,o,e.result)})}},{key:"update",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!e)throw new Error("Kuzzle.document.update: index is required");if(!t)throw new Error("Kuzzle.document.update: collection is required");if(!r)throw new Error("Kuzzle.document.update: _id is required");if(!n)throw new Error("Kuzzle.document.update: body is required");var i={index:e,collection:t,_id:r,body:n,action:"update",refresh:o.refresh,retryOnConflict:o.retryOnConflict};return delete o.refresh,delete o.retryOnConflict,this.query(i,o).then(function(e){return e.result})}},{key:"validate",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.document.validate: index is required");if(!t)throw new Error("Kuzzle.document.validate: collection is required");if(!r)throw new Error("Kuzzle.document.validate: body is required");return this.query({index:e,collection:t,body:r,action:"validate"},n).then(function(e){return e.result})}}])&&o(r.prototype,n),a&&o(r,a),t}();e.exports=a},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=r(1),l=function(e){function t(e,r,n,u){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(s=o(this,i(t).call(this,e,r,n,u)))._searchAction="search",s._scrollAction="scroll",s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,s),t}();e.exports=l},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(0),c=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,u(t).call(this,e,"index"))}var r,n,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),r=t,(n=[{key:"create",value:function(e,t){if(!e)throw new Error("Kuzzle.index.create: index is required");return this.query({index:e,action:"create"},t).then(function(e){return e.result})}},{key:"delete",value:function(e,t){if(!e)throw new Error("Kuzzle.index.delete: index is required");return this.query({index:e,action:"delete"},t).then(function(e){return e.result.acknowledged})}},{key:"exists",value:function(e,t){if(!e)throw new Error("Kuzzle.index.exists: index is required");return this.query({index:e,action:"exists"},t).then(function(e){return e.result})}},{key:"getAutoRefresh",value:function(e,t){if(!e)throw new Error("Kuzzle.index.getAutoRefresh: index is required");return this.query({index:e,action:"getAutoRefresh"},t).then(function(e){return e.result})}},{key:"list",value:function(e){return this.query({action:"list"},e).then(function(e){return e.result.indexes})}},{key:"mDelete",value:function(e,t){if(!Array.isArray(e))throw new Error("Kuzzle.index.mDelete: indexes must be an array");return this.query({action:"mDelete",body:{indexes:e}},t).then(function(e){return e.result.deleted})}},{key:"refresh",value:function(e,t){if(!e||""===e)throw new Error("Kuzzle.index.refresh: index is required");return this.query({index:e,action:"refresh"},t).then(function(e){return e.result._shards})}},{key:"refreshInternal",value:function(e){return this.query({action:"refreshInternal"},e).then(function(e){return e.result.acknowledged})}},{key:"setAutoRefresh",value:function(e,t,r){if(!e||""===e)throw new Error("Kuzzle.index.setAutoRefresh: index is required");if("boolean"!=typeof t)throw new Error("Kuzzle.index.setAutoRefresh: autoRefresh must be a boolean");return this.query({index:e,action:"setAutoRefresh",body:{autoRefresh:t}},r).then(function(e){return e.result.response})}}])&&o(r.prototype,n),c&&o(r,c),t}();e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(0),c=r(20),a=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=i(this,u(t).call(this,e,"realtime"))).lastExpirationTimestamp=0,r.subscriptions={},r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),r=t,(n=[{key:"count",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.realtime.count: roomId is required");return this.query({action:"count",body:{roomId:e}},t).then(function(e){return e.result.count})}},{key:"publish",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!e)throw new Error("Kuzzle.realtime.publish: index is required");if(!t)throw new Error("Kuzzle.realtime.publish: collection is required");if(!r)throw new Error("Kuzzle.realtime.publish: message is required");var o={index:e,collection:t,body:r,action:"publish"};return this.query(o,n).then(function(e){return e.result.published})}},{key:"subscribe",value:function(e,t,r,n){var o=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!e)throw new Error("Kuzzle.realtime.subscribe: index is required");if(!t)throw new Error("Kuzzle.realtime.subscribe: collection is required");if(!r)throw new Error("Kuzzle.realtime.subscribe: filters is required");if(!n||"function"!=typeof n)throw new Error("Kuzzle.realtime.subscribe: a callback function is required");var u=new c(this,e,t,r,n,i);return u.subscribe().then(function(){return o.subscriptions[u.id]||(o.subscriptions[u.id]=[]),o.subscriptions[u.id].push(u),u.id})}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.realtime.unsubscribe: roomId is required");var r=this.subscriptions[e];if(!r)return Promise.reject(new Error("not subscribed to ".concat(e)));for(var n=0;n<r.length;n++){r[n].removeListeners()}return delete this.subscriptions[e],this.query({action:"unsubscribe",body:{roomId:e}},t).then(function(e){return e.result})}},{key:"tokenExpired",value:function(){for(var e=0,t=Object.keys(this.subscriptions);e<t.length;e++){var r=t[e];this.subscriptions[r].forEach(function(e){return e.removeListeners()})}this.subscriptions={},this.kuzzle.auth.authenticationToken=null;var n=Date.now();n-this.lastExpirationTimestamp>1e3&&(this.lastExpirationTimestamp=n,this.kuzzle.emit("tokenExpired"))}}])&&o(r.prototype,n),a&&o(r,a),t}();e.exports=a},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t,r,n,o,i){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=t,this.kuzzle=t.kuzzle,this.index=r,this.collection=n,this.callback=i,this.options=u,this.id=null,this.channel=null,this.request={index:r,collection:n,body:o,controller:"realtime",action:"subscribe"};for(var s=0,l=["state","scope","users","volatile"];s<l.length;s++){var c=l[s];this.request[c]=this.options[c],delete this.options[c]}this.autoResubscribe="boolean"==typeof u.autoResubscribe?u.autoResubscribe:this.kuzzle.autoResubscribe,this.subscribeToSelf="boolean"!=typeof u.subscribeToSelf||u.subscribeToSelf;for(var a=0,f=["autoResubscribe","subscribeToSelf"];a<f.length;a++){var d=f[a];delete this.options[d]}this._channelListener=this._channelListener.bind(this),this._reSubscribeListener=this._reSubscribeListener.bind(this)}var t,n,o;return t=e,(n=[{key:"subscribe",value:function(){var e=this;return this.kuzzle.query(this.request,this.options).then(function(t){return e.id=t.result.roomId,e.channel=t.result.channel,e.kuzzle.protocol.on(e.channel,e._channelListener),e.kuzzle.addListener("reconnected",e._reSubscribeListener),t})}},{key:"removeListeners",value:function(){this.kuzzle.removeListener("reconnected",this._reSubscribeListener),this.channel&&this.kuzzle.protocol.removeListener(this.channel,this._channelListener)}},{key:"_channelListener",value:function(e){if("TokenExpired"===e.type)return this.controller.tokenExpired();var t=e.volatile&&e.volatile.sdkInstanceId===this.kuzzle.protocol.id;!this.subscribeToSelf&&t||this.callback(e)}},{key:"_reSubscribeListener",value:function(){if(this.autoResubscribe)return this.subscribe()}}])&&r(t.prototype,n),o&&r(t,o),e}();e.exports=n},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(0),c=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,u(t).call(this,e,"server"))}var r,c,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),r=t,(c=[{key:"adminExists",value:function(e){return this.query({action:"adminExists"},e).then(function(e){if("object"!==n(e.result)||"boolean"!=typeof e.result.exists){var t=new Error("adminExists: bad response format");return t.status=400,t.response=e,Promise.reject(t)}return e.result.exists})}},{key:"getAllStats",value:function(e){return this.query({action:"getAllStats"},e).then(function(e){return e.result})}},{key:"getConfig",value:function(e){return this.query({action:"getConfig"},e).then(function(e){return e.result})}},{key:"getLastStats",value:function(e){return this.query({action:"getLastStats"},e).then(function(e){return e.result})}},{key:"getStats",value:function(e,t,r){return this.query({action:"getStats",startTime:e,stopTime:t},r).then(function(e){return e.result})}},{key:"info",value:function(e){return this.query({action:"info"},e).then(function(e){return e.result})}},{key:"now",value:function(e){return this.query({action:"now"},e).then(function(e){if("object"!==n(e.result)||"number"!=typeof e.result.now){var t=new Error("now: bad response format");return t.status=400,t.response=e,Promise.reject(t)}return e.result.now})}}])&&o(r.prototype,c),a&&o(r,a),t}();e.exports=c},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=r(0),c=r(5),a=r(23),f=r(6),d=r(24),h=r(3),p=r(25),y=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,u(t).call(this,e,"security"))}var r,n,y;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,l),r=t,(n=[{key:"createCredentials",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!t)throw new Error("Kuzzle.security.createCredentials: _id is required");if(!e)throw new Error("Kuzzle.security.createCredentials: strategy is required");if(!r)throw new Error("Kuzzle.security.createCredentials: body is required");return this.query({_id:t,strategy:e,body:r,action:"createCredentials"},n).then(function(e){return e.result})}},{key:"createFirstAdmin",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.createFirstAdmin: _id is required");if(!t)throw new Error("Kuzzle.security.createFirstAdmin: body is required");var o={_id:e,body:t,action:"createFirstAdmin",reset:n.reset};return delete n.reset,this.query(o,n).then(function(e){return new h(r.kuzzle,e.result._id,e.result._source)})}},{key:"createOrReplaceProfile",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.createOrReplaceProfile: _id is required");if(!t)throw new Error("Kuzzle.security.createOrReplaceProfile: body is required");var o={_id:e,body:t,action:"createOrReplaceProfile",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new f(r.kuzzle,e.result._id,e.result._source.policies)})}},{key:"createOrReplaceRole",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.createOrReplaceRole: _id is required");if(!t)throw new Error("Kuzzle.security.createOrReplaceRole: body is required");var o={_id:e,body:t,action:"createOrReplaceRole",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new c(r.kuzzle,e.result._id,e.result._source.controllers)})}},{key:"createProfile",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.createProfile: _id is required");if(!t)throw new Error("Kuzzle.security.createProfile: body is required");var o={_id:e,body:t,action:"createProfile",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new f(r.kuzzle,e.result._id,e.result._source.policies)})}},{key:"createRestrictedUser",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.credentials)throw new Error("Kuzzle.security.createRestrictedUser: body.credentials is required");e.content||(e.content={});var o={_id:r,body:e,action:"createRestrictedUser",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new h(t.kuzzle,e.result._id,e.result._source)})}},{key:"createRole",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.createRole: _id is required");if(!t)throw new Error("Kuzzle.security.createRole: body is required");var o={_id:e,body:t,action:"createRole",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new c(r.kuzzle,e.result._id,e.result._source.controllers)})}},{key:"createUser",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("Kuzzle.security.createUser: body is required");if(!t.content)throw new Error("Kuzzle.security.createUser: body.content is required");if(!t.credentials)throw new Error("Kuzzle.security.createUser: body.credentials is required");var o={_id:e,body:t,action:"createUser",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new h(r.kuzzle,e.result._id,e.result._source)})}},{key:"deleteCredentials",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("Kuzzle.security.deleteCredentials: _id is required");if(!e)throw new Error("Kuzzle.security.deleteCredentials: strategy is required");return this.query({strategy:e,_id:t,action:"deleteCredentials"},r).then(function(e){return e.result})}},{key:"deleteProfile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.deleteProfile: _id is required");return this.query({_id:e,action:"deleteProfile"},t).then(function(e){return e.result})}},{key:"deleteRole",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.deleteRole: _id is required");return this.query({_id:e,action:"deleteRole"},t).then(function(e){return e.result})}},{key:"deleteUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.deleteUser: _id is required");return this.query({_id:e,action:"deleteUser"},t).then(function(e){return e.result})}},{key:"getAllCredentialFields",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getAllCredentialFields"},e).then(function(e){return e.result})}},{key:"getCredentialFields",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.getCredentialFields: strategy is required");return this.query({strategy:e,action:"getCredentialFields"},t).then(function(e){return e.result})}},{key:"getCredentials",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.getCredentials: strategy is required");if(!t)throw new Error("Kuzzle.security.getCredentials: _id is required");return this.query({strategy:e,_id:t,action:"getCredentials"},r).then(function(e){return e.result})}},{key:"getCredentialsById",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.getCredentialsById: strategy is required");if(!t)throw new Error("Kuzzle.security.getCredentialsById: _id is required");return this.query({strategy:e,_id:t,action:"getCredentialsById"},r).then(function(e){return e.result})}},{key:"getProfile",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.getProfile: _id is required");return this.query({_id:e,action:"getProfile"},r).then(function(e){return new f(t.kuzzle,e.result._id,e.result._source.policies)})}},{key:"getProfileMapping",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getProfileMapping"},e).then(function(e){return e.result})}},{key:"getProfileRights",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.getProfileRights: _id is required");return this.query({_id:e,action:"getProfileRights"},t).then(function(e){return e.result.hits})}},{key:"getRole",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.getRole: _id is required");return this.query({_id:e,action:"getRole"},r).then(function(e){return new c(t.kuzzle,e.result._id,e.result._source.controllers)})}},{key:"getRoleMapping",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getRoleMapping"},e).then(function(e){return e.result})}},{key:"getUser",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.getUser: _id is required");return this.query({_id:e,action:"getUser"},r).then(function(e){return new h(t.kuzzle,e.result._id,e.result._source)})}},{key:"getUserMapping",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.query({action:"getUserMapping"},e).then(function(e){return e.result})}},{key:"getUserRights",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Kuzzle.security.getUserRights: _id is required");return this.query({_id:e,action:"getUserRights"},t).then(function(e){return e.result.hits})}},{key:"hasCredentials",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.hasCredentials: strategy is required");if(!t)throw new Error("Kuzzle.security.hasCredentials: _id is required");return this.query({strategy:e,_id:t,action:"hasCredentials"},r).then(function(e){return e.result})}},{key:"mDeleteProfiles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))throw new Error("Kuzzle.security.mDeleteProfiles: ids must be an array");var r={action:"mDeleteProfiles",body:{ids:e},refresh:t.refresh};return delete t.refresh,this.query(r,t).then(function(e){return e.result})}},{key:"mDeleteRoles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))throw new Error("Kuzzle.security.mDeleteRoles: ids must be an array");var r={action:"mDeleteRoles",body:{ids:e},refresh:t.refresh};return delete t.refresh,this.query(r,t).then(function(e){return e.result})}},{key:"mDeleteUsers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))throw new Error("Kuzzle.security.mDeleteUsers: ids must be an array");var r={action:"mDeleteUsers",body:{ids:e},refresh:t.refresh};return delete t.refresh,this.query(r,t).then(function(e){return e.result})}},{key:"mGetProfiles",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))throw new Error("Kuzzle.security.mGetProfiles: ids must be an array");return this.query({action:"mGetProfiles",body:{ids:e}},r).then(function(e){return e.result.hits.map(function(e){return new f(t.kuzzle,e._id,e._source.policies)})})}},{key:"mGetRoles",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Array.isArray(e))throw new Error("Kuzzle.security.mGetRoles: ids must be an array");return this.query({action:"mGetRoles",body:{ids:e}},r).then(function(e){return e.result.hits.map(function(e){return new c(t.kuzzle,e._id,e._source.controllers)})})}},{key:"replaceUser",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.replaceUser: _id is required");if(!t)throw new Error("Kuzzle.security.replaceUser: body is required");var o={_id:e,body:t,action:"replaceUser",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new h(r.kuzzle,e.result._id,e.result._source)})}},{key:"searchProfiles",value:function(e){for(var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={body:e,action:"searchProfiles"},o=0,i=["from","size","scroll"];o<i.length;o++){var u=i[o];n[u]=r[u],delete r[u]}return this.query(n,r).then(function(e){return new d(t.kuzzle,n,r,e.result)})}},{key:"searchRoles",value:function(e){for(var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={body:e,action:"searchRoles"},o=0,i=["from","size"];o<i.length;o++){var u=i[o];n[u]=r[u],delete r[u]}return this.query(n,r).then(function(e){return new a(t.kuzzle,n,r,e.result)})}},{key:"searchUsers",value:function(e){for(var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={body:e,action:"searchUsers"},o=0,i=["from","size","scroll"];o<i.length;o++){var u=i[o];n[u]=r[u],delete r[u]}return this.query(n,r).then(function(e){return new p(t.kuzzle,n,r,e.result)})}},{key:"updateCredentials",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!t)throw new Error("Kuzzle.security.updateCredentials: _id is required");if(!e)throw new Error("Kuzzle.security.updateCredentials: strategy is required");if(!r)throw new Error("Kuzzle.security.updateCredentials: body is required");return this.query({strategy:e,_id:t,body:r,action:"updateCredentials"},n).then(function(e){return e.result})}},{key:"updateProfile",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.updateProfile: _id is required");if(!t)throw new Error("Kuzzle.security.updateProfile: body is required");var o={_id:e,body:t,action:"updateProfile",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new f(r.kuzzle,e.result._id,e.result._source.policies)})}},{key:"updateProfileMapping",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({body:e,action:"updateProfileMapping"},t).then(function(e){return e.result})}},{key:"updateRole",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.updateRole: _id is required");if(!t)throw new Error("Kuzzle.security.updateRole: body is required");var o={_id:e,body:t,action:"updateRole",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new c(r.kuzzle,e.result._id,e.result._source.controllers)})}},{key:"updateRoleMapping",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({body:e,action:"updateRoleMapping"},t).then(function(e){return e.result})}},{key:"updateUser",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("Kuzzle.security.updateUser: _id is required");if(!t)throw new Error("Kuzzle.security.updateUser: body is required");var o={_id:e,body:t,action:"updateUser",refresh:n.refresh};return delete n.refresh,this.query(o,n).then(function(e){return new h(r.kuzzle,e.result._id,e.result._source)})}},{key:"updateUserMapping",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.query({body:e,action:"updateUserMapping"},t).then(function(e){return e.result})}},{key:"validateCredentials",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!t)throw new Error("Kuzzle.security.validateCredentials: _id is required");if(!e)throw new Error("Kuzzle.security.validateCredentials: strategy is required");if(!r)throw new Error("Kuzzle.security.validateCredentials: body is required");return this.query({_id:t,strategy:e,body:r,action:"validateCredentials"},n).then(function(e){return e.result})}}])&&o(r.prototype,n),y&&o(r,y),t}();e.exports=y},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(5),a=r(1),f=function(e){function t(e,r,n,o){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=i(this,s(t).call(this,e,r,n,o)))._searchAction="searchRoles",u._scrollAction=null,u.hits=u._response.hits.map(function(e){return new c(u._kuzzle,e._id,e._source.controllers)}),u}var r,n,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a),r=t,(n=[{key:"next",value:function(){if(this._request.scroll||this._request.sort)throw new Error("only from/size params are allowed for role search");return u(s(t.prototype),"next",this).call(this).then(function(e){return e?(e.hits=e._response.hits.map(function(t){return new c(e._kuzzle,t._id,t._source.controllers)}),e):null})}}])&&o(r.prototype,n),f&&o(r,f),t}();e.exports=f},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(6),a=r(1),f=function(e){function t(e,r,n,o){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=i(this,s(t).call(this,e,r,n,o)))._searchAction="searchProfiles",u._scrollAction="scrollProfiles",u.hits=o.hits.map(function(e){return new c(u._kuzzle,e._id,e._source.policies)}),u}var r,n,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a),r=t,(n=[{key:"next",value:function(){return u(s(t.prototype),"next",this).call(this).then(function(e){return e?(e.hits=e._response.hits.map(function(t){return new c(e._kuzzle,t._id,t._source.policies)}),e):null})}}])&&o(r.prototype,n),f&&o(r,f),t}();e.exports=f},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(1),a=r(3),f=function(e){function t(e,r,n,o){var u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(u=i(this,s(t).call(this,e,r,n,o)))._searchAction="searchUsers",u._scrollAction="scrollUsers",u.hits=u._response.hits.map(function(e){return new a(u._kuzzle,e._id,e._source)}),u}var r,n,f;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),r=t,(n=[{key:"next",value:function(){return u(s(t.prototype),"next",this).call(this).then(function(e){return e?(e.hits=e._response.hits.map(function(t){return new a(e._kuzzle,t._id,t._source)}),e):null})}}])&&o(r.prototype,n),f&&o(r,f),t}();e.exports=f},function(e,t,r){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}for(var s=r(0),l={getter:!0,required:["_id"]},c={getter:!0,required:["_id","field"]},a={getter:!0,required:["keys"]},f={getter:!0,required:["_id","member"]},d={getter:!0,required:["_id","cursor"],opts:["match","count"],mapResults:x},h={getter:!0,required:["_id","start","stop"],opts:T,mapResults:S},p={getter:!0,required:["_id","min","max"],opts:T,mapResults:S},y={required:["_id"]},b={required:["_id","value"]},v={append:b,bitcount:{getter:!0,required:["_id"],opts:["start","end"]},bitop:{required:["_id","operation","keys"]},bitpos:{getter:!0,required:["_id","bit"],opts:["start","end"]},dbsize:{getter:!0},decr:y,decrby:b,del:{required:["keys"]},exists:a,expire:{required:["_id","seconds"],mapResults:Boolean},expireat:{required:["_id","timestamp"],mapResults:Boolean},flushdb:{mapResults:q},geoadd:{required:["_id","points"]},geodist:{getter:!0,required:["_id","member1","member2"],opts:["unit"],mapResults:parseFloat},geohash:{getter:!0,required:["_id","members"]},geopos:{getter:!0,required:["_id","members"],mapResults:function(e){return e.map(function(e){return e.map(parseFloat)})}},georadius:{getter:!0,required:["_id","lon","lat","distance","unit"],opts:E,mapResults:O},georadiusbymember:{getter:!0,required:["_id","member","distance","unit"],opts:E,mapResults:O},get:l,getbit:{getter:!0,required:["_id","offset"]},getrange:{getter:!0,required:["_id","start","end"]},getset:b,hdel:{required:["_id","fields"]},hexists:{getter:!0,required:["_id","field"],mapResults:Boolean},hget:c,hgetall:{getter:!0,required:["_id"]},hincrby:{required:["_id","field","value"]},hincrbyfloat:{required:["_id","field","value"],mapResults:parseFloat},hkeys:l,hlen:l,hmget:{getter:!0,required:["_id","fields"]},hmset:{required:["_id","entries"],mapResults:q},hscan:d,hset:{required:["_id","field","value"],mapResults:Boolean},hsetnx:{required:["_id","field","value"],mapResults:Boolean},hstrlen:c,hvals:l,incr:y,incrby:b,incrbyfloat:{required:["_id","value"],mapResults:parseFloat},keys:{getter:!0,required:["pattern"]},lindex:{getter:!0,required:["_id","idx"]},linsert:{required:["_id","position","pivot","value"]},llen:l,lpop:y,lpush:{required:["_id","values"]},lpushx:b,lrange:{getter:!0,required:["_id","start","stop"]},lrem:{required:["_id","count","value"]},lset:{required:["_id","index","value"],mapResults:q},ltrim:{required:["_id","start","stop"],mapResults:q},mget:a,mset:{required:["entries"],mapResults:q},msetnx:{required:["entries"],mapResults:Boolean},object:{getter:!0,required:["_id","subcommand"]},persist:{required:["_id"],mapResults:Boolean},pexpire:{required:["_id","milliseconds"],mapResults:Boolean},pexpireat:{required:["_id","timestamp"],mapResults:Boolean},pfadd:{required:["_id","elements"],mapResults:Boolean},pfcount:a,pfmerge:{required:["_id","sources"],mapResults:q},ping:{getter:!0},psetex:{required:["_id","value","milliseconds"],mapResults:q},pttl:l,randomkey:{getter:!0},rename:{required:["_id","newkey"],mapResults:q},renamenx:{required:["_id","newkey"],mapResults:Boolean},rpop:y,rpoplpush:{required:["source","destination"]},rpush:{required:["_id","values"]},rpushx:b,sadd:{required:["_id","members"]},scan:{getter:!0,required:["cursor"],opts:["match","count"],mapResults:x},scard:l,sdiff:{getter:!0,required:["_id","keys"]},sdiffstore:{required:["_id","keys","destination"]},set:{required:["_id","value"],opts:["ex","px","nx","xx"],mapResults:q},setex:{required:["_id","value","seconds"],mapResults:q},setnx:{required:["_id","value"],mapResults:Boolean},sinter:a,sinterstore:{required:["destination","keys"]},sismember:{getter:!0,required:["_id","member"],mapResults:Boolean},smembers:l,smove:{required:["_id","destination","member"],mapResults:Boolean},sort:{required:["_id"],opts:["alpha","by","direction","get","limit"]},spop:{required:["_id"],opts:["count"],mapResults:k},srandmember:{getter:!0,required:["_id"],opts:["count"],mapResults:k},srem:{required:["_id","members"]},sscan:d,strlen:l,sunion:a,sunionstore:{required:["destination","keys"]},time:{getter:!0,mapResults:function(e){return e.map(function(e){return parseInt(e)})}},touch:{required:["keys"]},ttl:l,type:l,zadd:{required:["_id","elements"],opts:["nx","xx","ch","incr"]},zcard:l,zcount:{getter:!0,required:["_id","min","max"]},zincrby:{required:["_id","member","value"]},zinterstore:{required:["_id","keys"],opts:["weights","aggregate"]},zlexcount:{getter:!0,required:["_id","min","max"]},zrange:h,zrangebylex:{getter:!0,required:["_id","min","max"],opts:["limit"]},zrevrangebylex:{getter:!0,required:["_id","min","max"],opts:["limit"]},zrangebyscore:p,zrank:f,zrem:{required:["_id","members"]},zremrangebylex:{required:["_id","min","max"]},zremrangebyrank:{required:["_id","start","stop"]},zremrangebyscore:{required:["_id","min","max"]},zrevrange:h,zrevrangebyscore:p,zrevrank:f,zscan:d,zscore:{getter:!0,required:["_id","member"],mapResults:parseFloat},zunionstore:{required:["_id","keys"],opts:["weights","aggregate"]}},m=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,i(t).call(this,e,"ms"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,s),t}(),_=function(e,t){var r=t[e];m.prototype[r]=function(){var e=v[r],t={action:r},o={};e.getter||(t.body={});for(var i=arguments.length,u=new Array(i),s=0;s<i;s++)u[s]=arguments[s];for(var l=0,c=e.required||[];l<c.length;l++){var a=c[l],f=u.shift();if(void 0===f)throw new Error("ms.".concat(r,": missing parameter ").concat(a));z(t,e.getter,a,f)}if(u.length>1)throw new Error("ms.".concat(r,": too many parameters provided"));if(u.length){if("object"!==n(u[0])||Array.isArray(u[0]))throw new Error("ms.".concat(r,": invalid optional paramater (expected an object"));if(Object.assign(o,u[0]),Array.isArray(e.opts))for(var d=0,h=e.opts;d<h.length;d++){var p=h[d];null!==o[p]&&void 0!==o[p]&&(z(t,e.getter,p,o[p]),delete o[p])}}return"function"==typeof e.opts&&e.opts(t,o),this.query(t,o).then(function(t){return e.mapResults?e.mapResults(t.result):t.result})}},g=0,w=Object.keys(v);g<w.length;g++)_(g,w);function z(e,t,r,n){t||"_id"===r?e[r]=n:e.body[r]=n}function E(e,t){var r=[];Object.keys(t).filter(function(e){return t[e]&&-1!==["withcoord","withdist","count","sort"].indexOf(e)}).forEach(function(e){"withcoord"===e||"withdist"===e?(r.push(e),delete t[e]):"count"!==e&&"sort"!==e||("count"===e&&r.push("count"),r.push(t[e])),delete t[e]}),r.length>0&&(e.options=r)}function T(e,t){e.options=["withscores"],t.limit&&(e.limit=t.limit,delete t.limit)}function O(e){return Array.isArray(e[0])?e.map(function(e){for(var t={name:e.shift()},r=0;r<e.length;r++){var n=e[r];Array.isArray(n)?t.coordinates=n.map(parseFloat):t.distance=parseFloat(n)}return t}):e.map(function(e){return{name:e}})}function k(e){return Array.isArray(e)?e:[e]}function q(){}function S(e){for(var t=[],r=0;r<e.length;r+=2)t.push({member:e[r],score:parseFloat(e[r+1])});return t}function x(e){return{cursor:e[0],values:e[1]}}e.exports=m},function(e,t){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=function(e){return n(new Set(e))};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"object"!==r(e)&&"function"!=typeof e)throw Error("proxify only applies on non-null object");var i=function(e){return Object.assign({},{name:"object",seal:!0,sealGet:!1,deprecated:[],warnDeprecationOnce:!0,exposeApi:!1,apiNamespace:"__proxy__"},e)}(t),u=new Set(["inspect"]),s=new Set(i.deprecated),l=new Set,c=function(e){var t="".concat(i.name,".").concat(e);i.warnDeprecationOnce&&l.has(t)||(l.add(t),console.warn("Warning: ".concat(t," is deprecated")))};return i.exposeApi&&(e[i.apiNamespace]={registerProp:function(e){return u.add(e)},unregisterProp:function(e){return u.delete(e)},hasProp:function(e){return u.has(e)}}),[].concat(n(Object.getOwnPropertyNames(e)),n(function e(t){if(!t)return[];var r=Object.getOwnPropertyNames(t.prototype||t),i=Object.getPrototypeOf(t);return o([].concat(n(r),n(e(i))))}(e))).forEach(function(e){return u.add(e)}),new Proxy(e,{get:function(e,t){if(i.sealGet&&!u.has(t))throw new Error("".concat(i.name,".").concat(t," is not defined"));return s.has(t)&&c(t),e[t]},set:function(e,t,r){if(i.seal&&!u.has(t))throw new Error("Cannot set a value to the undefined '".concat(t,"' property in '").concat(i.name,"'"));return s.has(t)&&c(t),e[t]=r,!0}})}},function(e,t,r){"use strict";var n=r(29),o=r(32),i=r(33);e.exports={Http:n,WebSocket:o,SocketIO:i}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(4),a=r(31),f=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=u(this,s(t).call(this,e,n)),"string"!=typeof e||""===e)throw new Error("host is required");if(n.http&&n.http.customRoutes)for(var o in n.http.customRoutes)n.http.customRoutes.hasOwnProperty(o)&&(r.http.routes[o]=Object.assign(r.http.routes[o]||{},n.http.customRoutes[o]));return r}var n,f,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),n=t,(f=[{key:"connect",value:function(){var e=this;return"ready"===this.state?Promise.resolve():this._sendHttpRequest("GET","/").then(function(){e.clientConnected()}).catch(function(t){var r=new Error("Unable to connect to kuzzle server at ".concat(e.host,":").concat(e.port));throw r.internal=t,e.emit("networkError",r),t})}},{key:"send",value:function(e){for(var t=this,r={action:void 0,body:void 0,collection:void 0,controller:void 0,headers:{"Content-Type":"application/json"},index:void 0,meta:void 0,requestId:void 0},n={},i=0,u=Object.keys(e);i<u.length;i++){var s=u[i],l=e[s];"body"===s?r.body=JSON.stringify(l):"jwt"===s?r.headers.authorization="Bearer "+l:"volatile"===s?r.headers["x-kuzzle-volatile"]=JSON.stringify(l):r.hasOwnProperty(s)?r[s]=l:null!=l&&(n[s]=l)}var c=this.http.routes[r.controller]&&this.http.routes[r.controller][r.action];if(void 0===c){var a=new Error("No route found for ".concat(r.controller,"/").concat(r.action));this.emit(r.requestId,{status:400,error:a})}for(var f=c.verb,d=/\/:([^\/]*)/,h=c.url,p=d.exec(h);p;)h=h.replace(d,"/"+e[p[1]]),delete n[p[1]],p=d.exec(h);for(var y=[],b=function(e,t){var r=t[e],i=n[r];Array.isArray(i)?y.push.apply(y,o(i.map(function(e){return"".concat(r,"=").concat(e)}))):y.push("".concat(r,"=").concat(i))},v=0,m=Object.keys(n);v<m.length;v++)b(v,m);y.length>0&&(h+="?"+y.join("&")),this._sendHttpRequest(f,h,r).then(function(e){return t.emit(r.requestId,e)}).catch(function(e){return t.emit(r.requestId,{error:e})})}},{key:"_sendHttpRequest",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("undefined"==typeof XMLHttpRequest){var i=r(!function(){var e=new Error("Cannot find module 'min-req-promise'");throw e.code="MODULE_NOT_FOUND",e}());"/"!==t[0]&&(t="/".concat(t));var u="".concat(this.protocol,"://").concat(this.host,":").concat(this.port).concat(t),s=o.headers||{};return s["Content-Length"]=Buffer.byteLength(o.body||""),i.request(u,e,{headers:s,body:o.body}).then(function(e){return JSON.parse(e.body)})}return new Promise(function(r,i){var u=new XMLHttpRequest,s="".concat(n.protocol,"://").concat(n.host,":").concat(n.port).concat(t);u.open(e,s);for(var l=0,c=Object.keys(o.headers||{});l<c.length;l++){var a=c[l];u.setRequestHeader(a,o.headers[a])}u.onload=function(){try{var e=JSON.parse(u.responseText);r(e)}catch(e){i(e)}},u.send(o.body)})}},{key:"http",get:function(){return a}},{key:"protocol",get:function(){return this.ssl?"https":"http"}},{key:"connected",get:function(){return!0}}])&&i(n.prototype,f),d&&i(n,d),t}();e.exports=f},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){var t="function"==typeof Map?new Map:void 0;return(i=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s(n,e)})(e)}function u(e,t,r){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&s(o,r.prototype),o}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=o(this,l(t).call(this,e.message))).status=e.status,r.stack=e.stack,206===r.status&&(r.errors=e.errors,r.count=e.count),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,i(Error)),t}();e.exports=c},function(e){e.exports={routes:{auth:{login:{verb:"POST",url:"/_login/:strategy"},logout:{url:"/_logout",verb:"POST"},getCurrentUser:{url:"/users/_me",verb:"GET"},getMyRights:{url:"/users/_me/_rights",verb:"GET"},checkToken:{url:"/_checkToken",verb:"POST"},updateSelf:{url:"/_updateSelf",verb:"PUT"},getStrategies:{url:"/strategies",verb:"GET"},createMyCredentials:{url:"/credentials/:strategy/_me/_create",verb:"POST"},updateMyCredentials:{url:"/credentials/:strategy/_me/_update",verb:"PUT"},credentialsExist:{url:"/credentials/:strategy/_me/_exists",verb:"GET"},validateMyCredentials:{url:"/credentials/:strategy/_me/_validate",verb:"POST"},deleteMyCredentials:{url:"/credentials/:strategy/_me",verb:"DELETE"},getMyCredentials:{url:"/credentials/:strategy/_me",verb:"GET"}},bulk:{import:{verb:"POST",url:"/:index/:collection/_bulk"}},document:{create:{verb:"POST",url:"/:index/:collection/_create"},search:{url:"/:index/:collection",verb:"GET"},scroll:{url:"/_scroll/:scrollId",verb:"GET"},exists:{url:"/:index/:collection/:_id/_exists",verb:"GET"},get:{url:"/:index/:collection/:_id",verb:"GET"},mGet:{url:"/:index/:collection/_mGet",verb:"POST"},count:{url:"/:index/:collection/_count",verb:"POST"},mCreate:{url:"/:index/:collection/_mCreate",verb:"POST"},createOrReplace:{url:"/:index/:collection/:_id",verb:"PUT"},mCreateOrReplace:{url:"/:index/:collection/_mCreateOrReplace",verb:"PUT"},update:{url:"/:index/:collection/:_id/_update",verb:"PUT"},mUpdate:{url:"/:index/:collection/_mUpdate",verb:"PUT"},replace:{url:"/:index/:collection/:_id/_replace",verb:"PUT"},mReplace:{url:"/:index/:collection/_mReplace",verb:"PUT"},delete:{url:"/:index/:collection/:_id",verb:"DELETE"},mDelete:{url:"/:index/:collection/_mDelete",verb:"DELETE"},deleteByQuery:{url:"/:index/:collection/_query",verb:"DELETE"},validate:{url:"/:index/:collection/_validate",verb:"POST"}},security:{createFirstAdmin:{verb:"POST",url:"/_createFirstAdmin"},createRestrictedUser:{verb:"POST",url:"/users/_createRestricted"},createUser:{verb:"POST",url:"/users/_create"},getRoleMapping:{url:"/roles/_mapping",verb:"GET"},updateRoleMapping:{url:"/roles/_mapping",verb:"PUT"},getProfileMapping:{url:"/profiles/_mapping",verb:"GET"},updateProfileMapping:{url:"/profiles/_mapping",verb:"PUT"},getUserMapping:{url:"/users/_mapping",verb:"GET"},updateUserMapping:{url:"/users/_mapping",verb:"PUT"},getRole:{url:"/roles/:_id",verb:"GET"},mGetRoles:{url:"/roles/_mGet",verb:"POST"},searchRoles:{url:"/roles/_search",verb:"POST"},createOrReplaceRole:{url:"/roles/:_id",verb:"PUT"},createRole:{url:"/roles/:_id/_create",verb:"POST"},deleteRole:{url:"/roles/:_id",verb:"DELETE"},getProfile:{url:"/profiles/:_id",verb:"GET"},mGetProfiles:{url:"/profiles/_mGet",verb:"POST"},createOrReplaceProfile:{url:"/profiles/:_id",verb:"PUT"},createProfile:{url:"/profiles/:_id/_create",verb:"POST"},deleteProfile:{url:"/profiles/:_id",verb:"DELETE"},searchProfiles:{url:"/profiles/_search",verb:"POST"},getUser:{url:"/users/:_id",verb:"GET"},getProfileRights:{url:"/profiles/:_id/_rights",verb:"GET"},getUserRights:{url:"/users/:_id/_rights",verb:"GET"},searchUsers:{url:"/users/_search",verb:"POST"},deleteUser:{url:"/users/:_id",verb:"DELETE"},updateUser:{url:"/users/:_id/_update",verb:"PUT"},replaceUser:{url:"/users/:_id/_replace",verb:"PUT"},updateProfile:{url:"/profiles/:_id/_update",verb:"PUT"},updateRole:{url:"/roles/:_id/_update",verb:"PUT"},mDeleteProfiles:{url:"/profiles/_mDelete",verb:"POST"},mDeleteRoles:{url:"/roles/_mDelete",verb:"POST"},mDeleteUsers:{url:"/users/_mDelete",verb:"POST"},scrollUsers:{url:"/users/_scroll/:scrollId",verb:"GET"},scrollProfiles:{url:"/profiles/_scroll/:scrollId",verb:"GET"},createCredentials:{url:"/credentials/:strategy/:_id/_create",verb:"POST"},updateCredentials:{url:"/credentials/:strategy/:_id/_update",verb:"PUT"},hasCredentials:{url:"/credentials/:strategy/:_id/_exists",verb:"GET"},validateCredentials:{url:"/credentials/:strategy/:_id/_validate",verb:"POST"},deleteCredentials:{url:"/credentials/:strategy/:_id",verb:"DELETE"},getCredentials:{url:"/credentials/:strategy/:_id",verb:"GET"},getCredentialsById:{url:"/credentials/:strategy/:_id/_byId",verb:"GET"},getCredentialFields:{url:"/credentials/:strategy/_fields",verb:"GET"},getAllCredentialFields:{url:"/credentials/_fields",verb:"GET"}},collection:{updateMapping:{url:"/:index/:collection/_mapping",verb:"PUT"},getMapping:{url:"/:index/:collection/_mapping",verb:"GET"},getSpecifications:{url:"/:index/:collection/_specifications",verb:"GET"},searchSpecifications:{url:"/validations/_search",verb:"POST"},scrollSpecifications:{url:"/validations/_scroll/:scrollId",verb:"GET"},updateSpecifications:{url:"/_specifications",verb:"PUT"},deleteSpecifications:{url:"/:index/:collection/_specifications",verb:"DELETE"},validateSpecifications:{url:"/_validateSpecifications",verb:"POST"},truncate:{url:"/:index/:collection/_truncate",verb:"DELETE"},list:{url:"/:index/_list",verb:"GET"},exists:{url:"/:index/:collection/_exists",verb:"GET"},create:{url:"/:index/:collection",verb:"PUT"}},index:{mDelete:{url:"/_mdelete",verb:"DELETE"},create:{url:"/:index/_create",verb:"POST"},delete:{url:"/:index",verb:"DELETE"},refresh:{url:"/:index/_refresh",verb:"POST"},list:{url:"/_list",verb:"GET"},refreshInternal:{url:"/_refreshInternal",verb:"POST"},getAutoRefresh:{url:"/:index/_autoRefresh",verb:"GET"},setAutoRefresh:{url:"/:index/_autoRefresh",verb:"POST"},exists:{url:"/:index/_exists",verb:"GET"}},ms:{append:{url:"/ms/_append/:_id",verb:"POST"},bitcount:{url:"/ms/_bitcount/:_id",verb:"GET"},bitop:{url:"/ms/_bitop/:_id",verb:"POST"},bitpos:{url:"/ms/_bitpos/:_id",verb:"GET"},dbsize:{url:"/ms/_dbsize",verb:"GET"},decrby:{url:"/ms/_decrby/:_id",verb:"POST"},del:{url:"/ms",verb:"DELETE"},expire:{url:"/ms/_expire/:_id",verb:"POST"},expireat:{url:"/ms/_expireat/:_id",verb:"POST"},flushdb:{url:"/ms/_flushdb",verb:"POST"},geoadd:{url:"/ms/_geoadd/:_id",verb:"POST"},geodist:{url:"/ms/_geodist/:_id/:member1/:member2",verb:"GET"},geohash:{url:"/ms/_geohash/:_id",verb:"GET"},georadius:{url:"/ms/_georadius/:_id",verb:"GET"},georadiusbymember:{url:"/ms/_georadiusbymember/:_id",verb:"GET"},getbit:{url:"/ms/_getbit/:_id",verb:"GET"},getrange:{url:"/ms/_getrange/:_id",verb:"GET"},hdel:{url:"/ms/_hdel/:_id",verb:"DELETE"},hmget:{url:"/ms/_hmget/:_id",verb:"GET"},hexists:{url:"/ms/_hexists/:_id/:field",verb:"GET"},hincrby:{url:"/ms/_hincrby/:_id",verb:"POST"},hmset:{url:"/ms/_hmset/:_id",verb:"POST"},hset:{url:"/ms/_hset/:_id",verb:"POST"},hstrlen:{url:"/ms/_hstrlen/:_id/:field",verb:"GET"},keys:{url:"/ms/_keys/:pattern",verb:"GET"},lindex:{url:"/ms/_lindex/:_id/:idx",verb:"GET"},linsert:{url:"/ms/_linsert/:_id",verb:"POST"},lpush:{url:"/ms/_lpush/:_id",verb:"POST"},lrange:{url:"/ms/_lrange/:_id",verb:"GET"},lrem:{url:"/ms/_lrem/:_id",verb:"DELETE"},lset:{url:"/ms/_lset/:_id",verb:"POST"},ltrim:{url:"/ms/_ltrim/:_id",verb:"POST"},mget:{url:"/ms/_mget",verb:"GET"},mset:{url:"/ms/_mset",verb:"POST"},object:{url:"/ms/_object/:_id",verb:"GET"},pexpire:{url:"/ms/_pexpire/:_id",verb:"POST"},pexpireat:{url:"/ms/_pexpireat/:_id",verb:"POST"},pfadd:{url:"/ms/_pfadd/:_id",verb:"POST"},pfmerge:{url:"/ms/_pfmerge/:_id",verb:"POST"},ping:{url:"/ms/_ping",verb:"GET"},psetex:{url:"/ms/_psetex/:_id",verb:"POST"},randomkey:{url:"/ms/_randomkey",verb:"GET"},rename:{url:"/ms/_rename/:_id",verb:"POST"},renamenx:{url:"/ms/_renamenx/:_id",verb:"POST"},rpoplpush:{url:"/ms/_rpoplpush",verb:"POST"},sadd:{url:"/ms/_sadd/:_id",verb:"POST"},scan:{url:"/ms/_scan",verb:"GET"},sdiff:{url:"/ms/_sdiff/:_id",verb:"GET"},sdiffstore:{url:"/ms/_sdiffstore/:_id",verb:"POST"},set:{url:"/ms/_set/:_id",verb:"POST"},setex:{url:"/ms/_setex/:_id",verb:"POST"},setnx:{url:"/ms/_setnx/:_id",verb:"POST"},sinterstore:{url:"/ms/_sinterstore",verb:"POST"},sismember:{url:"/ms/_sismember/:_id/:member",verb:"GET"},smove:{url:"/ms/_smove/:_id",verb:"POST"},sort:{url:"/ms/_sort/:_id",verb:"POST"},spop:{url:"/ms/_spop/:_id",verb:"POST"},srandmember:{url:"/ms/_srandmember/:_id",verb:"GET"},srem:{url:"/ms/_srem/:_id",verb:"DELETE"},sscan:{url:"/ms/_sscan/:_id",verb:"GET"},sunion:{url:"/ms/_sunion",verb:"GET"},sunionstore:{url:"/ms/_sunionstore",verb:"POST"},time:{url:"/ms/_time",verb:"GET"},touch:{url:"/ms/_touch",verb:"POST"},zadd:{url:"/ms/_zadd/:_id",verb:"POST"},zcount:{url:"/ms/_zcount/:_id",verb:"GET"},zincrby:{url:"/ms/_zincrby/:_id",verb:"POST"},zinterstore:{url:"/ms/_zinterstore/:_id",verb:"POST"},zlexcount:{url:"/ms/_zlexcount/:_id",verb:"GET"},zrange:{url:"/ms/_zrange/:_id",verb:"GET"},zrangebylex:{url:"/ms/_zrangebylex/:_id",verb:"GET"},zrangebyscore:{url:"/ms/_zrangebyscore/:_id",verb:"GET"},zrem:{url:"/ms/_zrem/:_id",verb:"DELETE"},zremrangebylex:{url:"/ms/_zremrangebylex/:_id",verb:"DELETE"},zremrangebyrank:{url:"/ms/_zremrangebyrank/:_id",verb:"DELETE"},zremrangebyscore:{url:"/ms/_zremrangebyscore/:_id",verb:"DELETE"},zrevrangebylex:{url:"/ms/_zrevrangebylex/:_id",verb:"GET"},zrevrangebyscore:{url:"/ms/_zrevrangebyscore/:_id",verb:"GET"},zrevrank:{url:"/ms/_zrevrank/:_id/:member",verb:"GET"},zunionstore:{url:"/ms/_zunionstore/:_id",verb:"POST"},zcard:{url:"/ms/_zcard/:_id",verb:"GET"},type:{url:"/ms/_type/:_id",verb:"GET"},ttl:{url:"/ms/_ttl/:_id",verb:"GET"},strlen:{url:"/ms/_strlen/:_id",verb:"GET"},smembers:{url:"/ms/_smembers/:_id",verb:"GET"},scard:{url:"/ms/_scard/:_id",verb:"GET"},rpop:{url:"/ms/_rpop/:_id",verb:"POST"},pttl:{url:"/ms/_pttl/:_id",verb:"GET"},persist:{url:"/ms/_persist/:_id",verb:"POST"},lpop:{url:"/ms/_lpop/:_id",verb:"POST"},llen:{url:"/ms/_llen/:_id",verb:"GET"},incr:{url:"/ms/_incr/:_id",verb:"POST"},hvals:{url:"/ms/_hvals/:_id",verb:"GET"},hlen:{url:"/ms/_hlen/:_id",verb:"GET"},hkeys:{url:"/ms/_hkeys/:_id",verb:"GET"},hgetall:{url:"/ms/_hgetall/:_id",verb:"GET"},get:{url:"/ms/:_id",verb:"GET"},decr:{url:"/ms/_decr/:_id",verb:"POST"},rpushx:{url:"/ms/_rpushx/:_id",verb:"POST"},lpushx:{url:"/ms/_lpushx/:_id",verb:"POST"},getset:{url:"/ms/_getset/:_id",verb:"POST"},sinter:{url:"/ms/_sinter",verb:"GET"},pfcount:{url:"/ms/_pfcount",verb:"GET"},incrbyfloat:{url:"/ms/_incrbyfloat/:_id",verb:"POST"},incrby:{url:"/ms/_incrby/:_id",verb:"POST"},geopos:{url:"/ms/_geopos/:_id",verb:"GET"},hget:{url:"/ms/_hget/:_id/:field",verb:"GET"},hsetnx:{url:"/ms/_hsetnx/:_id",verb:"POST"},msetnx:{url:"/ms/_msetnx",verb:"POST"},rpush:{url:"/ms/_rpush/:_id",verb:"POST"},hincrbyfloat:{url:"/ms/_hincrbyfloat/:_id",verb:"POST"},zrevrange:{url:"/ms/_zrevrange/:_id",verb:"GET"},zrank:{url:"/ms/_zrank/:_id/:member",verb:"GET"},zscore:{url:"/ms/_zscore/:_id/:member",verb:"GET"},zscan:{url:"/ms/_zscan/:_id",verb:"GET"},hscan:{url:"/ms/_hscan/:_id",verb:"GET"},exists:{url:"/ms/_exists",verb:"GET"}},memoryStorage:{append:{url:"/ms/_append/:_id",verb:"POST"},bitcount:{url:"/ms/_bitcount/:_id",verb:"GET"},bitop:{url:"/ms/_bitop/:_id",verb:"POST"},bitpos:{url:"/ms/_bitpos/:_id",verb:"GET"},dbsize:{url:"/ms/_dbsize",verb:"GET"},decrby:{url:"/ms/_decrby/:_id",verb:"POST"},del:{url:"/ms",verb:"DELETE"},expire:{url:"/ms/_expire/:_id",verb:"POST"},expireat:{url:"/ms/_expireat/:_id",verb:"POST"},flushdb:{url:"/ms/_flushdb",verb:"POST"},geoadd:{url:"/ms/_geoadd/:_id",verb:"POST"},geodist:{url:"/ms/_geodist/:_id/:member1/:member2",verb:"GET"},geohash:{url:"/ms/_geohash/:_id",verb:"GET"},georadius:{url:"/ms/_georadius/:_id",verb:"GET"},georadiusbymember:{url:"/ms/_georadiusbymember/:_id",verb:"GET"},getbit:{url:"/ms/_getbit/:_id",verb:"GET"},getrange:{url:"/ms/_getrange/:_id",verb:"GET"},hdel:{url:"/ms/_hdel/:_id",verb:"DELETE"},hmget:{url:"/ms/_hmget/:_id",verb:"GET"},hexists:{url:"/ms/_hexists/:_id/:field",verb:"GET"},hincrby:{url:"/ms/_hincrby/:_id",verb:"POST"},hmset:{url:"/ms/_hmset/:_id",verb:"POST"},hset:{url:"/ms/_hset/:_id",verb:"POST"},hstrlen:{url:"/ms/_hstrlen/:_id/:field",verb:"GET"},keys:{url:"/ms/_keys/:pattern",verb:"GET"},lindex:{url:"/ms/_lindex/:_id/:idx",verb:"GET"},linsert:{url:"/ms/_linsert/:_id",verb:"POST"},lpush:{url:"/ms/_lpush/:_id",verb:"POST"},lrange:{url:"/ms/_lrange/:_id",verb:"GET"},lrem:{url:"/ms/_lrem/:_id",verb:"DELETE"},lset:{url:"/ms/_lset/:_id",verb:"POST"},ltrim:{url:"/ms/_ltrim/:_id",verb:"POST"},mget:{url:"/ms/_mget",verb:"GET"},mset:{url:"/ms/_mset",verb:"POST"},object:{url:"/ms/_object/:_id",verb:"GET"},pexpire:{url:"/ms/_pexpire/:_id",verb:"POST"},pexpireat:{url:"/ms/_pexpireat/:_id",verb:"POST"},pfadd:{url:"/ms/_pfadd/:_id",verb:"POST"},pfmerge:{url:"/ms/_pfmerge/:_id",verb:"POST"},ping:{url:"/ms/_ping",verb:"GET"},psetex:{url:"/ms/_psetex/:_id",verb:"POST"},randomkey:{url:"/ms/_randomkey",verb:"GET"},rename:{url:"/ms/_rename/:_id",verb:"POST"},renamenx:{url:"/ms/_renamenx/:_id",verb:"POST"},rpoplpush:{url:"/ms/_rpoplpush",verb:"POST"},sadd:{url:"/ms/_sadd/:_id",verb:"POST"},scan:{url:"/ms/_scan",verb:"GET"},sdiff:{url:"/ms/_sdiff/:_id",verb:"GET"},sdiffstore:{url:"/ms/_sdiffstore/:_id",verb:"POST"},set:{url:"/ms/_set/:_id",verb:"POST"},setex:{url:"/ms/_setex/:_id",verb:"POST"},setnx:{url:"/ms/_setnx/:_id",verb:"POST"},sinterstore:{url:"/ms/_sinterstore",verb:"POST"},sismember:{url:"/ms/_sismember/:_id/:member",verb:"GET"},smove:{url:"/ms/_smove/:_id",verb:"POST"},sort:{url:"/ms/_sort/:_id",verb:"POST"},spop:{url:"/ms/_spop/:_id",verb:"POST"},srandmember:{url:"/ms/_srandmember/:_id",verb:"GET"},srem:{url:"/ms/_srem/:_id",verb:"DELETE"},sscan:{url:"/ms/_sscan/:_id",verb:"GET"},sunion:{url:"/ms/_sunion",verb:"GET"},sunionstore:{url:"/ms/_sunionstore",verb:"POST"},time:{url:"/ms/_time",verb:"GET"},touch:{url:"/ms/_touch",verb:"POST"},zadd:{url:"/ms/_zadd/:_id",verb:"POST"},zcount:{url:"/ms/_zcount/:_id",verb:"GET"},zincrby:{url:"/ms/_zincrby/:_id",verb:"POST"},zinterstore:{url:"/ms/_zinterstore/:_id",verb:"POST"},zlexcount:{url:"/ms/_zlexcount/:_id",verb:"GET"},zrange:{url:"/ms/_zrange/:_id",verb:"GET"},zrangebylex:{url:"/ms/_zrangebylex/:_id",verb:"GET"},zrangebyscore:{url:"/ms/_zrangebyscore/:_id",verb:"GET"},zrem:{url:"/ms/_zrem/:_id",verb:"DELETE"},zremrangebylex:{url:"/ms/_zremrangebylex/:_id",verb:"DELETE"},zremrangebyrank:{url:"/ms/_zremrangebyrank/:_id",verb:"DELETE"},zremrangebyscore:{url:"/ms/_zremrangebyscore/:_id",verb:"DELETE"},zrevrangebylex:{url:"/ms/_zrevrangebylex/:_id",verb:"GET"},zrevrangebyscore:{url:"/ms/_zrevrangebyscore/:_id",verb:"GET"},zrevrank:{url:"/ms/_zrevrank/:_id/:member",verb:"GET"},zunionstore:{url:"/ms/_zunionstore/:_id",verb:"POST"},zcard:{url:"/ms/_zcard/:_id",verb:"GET"},type:{url:"/ms/_type/:_id",verb:"GET"},ttl:{url:"/ms/_ttl/:_id",verb:"GET"},strlen:{url:"/ms/_strlen/:_id",verb:"GET"},smembers:{url:"/ms/_smembers/:_id",verb:"GET"},scard:{url:"/ms/_scard/:_id",verb:"GET"},rpop:{url:"/ms/_rpop/:_id",verb:"POST"},pttl:{url:"/ms/_pttl/:_id",verb:"GET"},persist:{url:"/ms/_persist/:_id",verb:"POST"},lpop:{url:"/ms/_lpop/:_id",verb:"POST"},llen:{url:"/ms/_llen/:_id",verb:"GET"},incr:{url:"/ms/_incr/:_id",verb:"POST"},hvals:{url:"/ms/_hvals/:_id",verb:"GET"},hlen:{url:"/ms/_hlen/:_id",verb:"GET"},hkeys:{url:"/ms/_hkeys/:_id",verb:"GET"},hgetall:{url:"/ms/_hgetall/:_id",verb:"GET"},get:{url:"/ms/:_id",verb:"GET"},decr:{url:"/ms/_decr/:_id",verb:"POST"},rpushx:{url:"/ms/_rpushx/:_id",verb:"POST"},lpushx:{url:"/ms/_lpushx/:_id",verb:"POST"},getset:{url:"/ms/_getset/:_id",verb:"POST"},sinter:{url:"/ms/_sinter",verb:"GET"},pfcount:{url:"/ms/_pfcount",verb:"GET"},incrbyfloat:{url:"/ms/_incrbyfloat/:_id",verb:"POST"},incrby:{url:"/ms/_incrby/:_id",verb:"POST"},geopos:{url:"/ms/_geopos/:_id",verb:"GET"},hget:{url:"/ms/_hget/:_id/:field",verb:"GET"},hsetnx:{url:"/ms/_hsetnx/:_id",verb:"POST"},msetnx:{url:"/ms/_msetnx",verb:"POST"},rpush:{url:"/ms/_rpush/:_id",verb:"POST"},hincrbyfloat:{url:"/ms/_hincrbyfloat/:_id",verb:"POST"},zrevrange:{url:"/ms/_zrevrange/:_id",verb:"GET"},zrank:{url:"/ms/_zrank/:_id/:member",verb:"GET"},zscore:{url:"/ms/_zscore/:_id/:member",verb:"GET"},zscan:{url:"/ms/_zscan/:_id",verb:"GET"},hscan:{url:"/ms/_hscan/:_id",verb:"GET"},exists:{url:"/ms/_exists",verb:"GET"}},realtime:{list:{url:"/_listSubscriptions",verb:"GET"},publish:{url:"/:index/:collection/_publish",verb:"POST"}},server:{getStats:{url:"/_getStats",verb:"GET"},getLastStats:{url:"/_getLastStats",verb:"GET"},getAllStats:{url:"/_getAllStats",verb:"GET"},getConfig:{url:"/_getConfig",verb:"GET"},adminExists:{url:"/_adminExists",verb:"GET"},now:{url:"/_now",verb:"GET"},healthCheck:{url:"/_healthCheck",verb:"GET"},info:{url:"/",verb:"GET"}},admin:{resetKuzzleData:{url:"/admin/_resetKuzzleData/",verb:"POST"},resetCache:{url:"/admin/_resetCache",verb:"POST"},resetSecurity:{url:"/admin/_resetSecurity/",verb:"POST"},resetDatabase:{url:"/admin/_resetDatabase/",verb:"POST"},dump:{url:"/admin/_dump",verb:"POST"},shutdown:{url:"/admin/_shutdown/",verb:"POST"}}}}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(8),a=function(e){function t(e){var o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=i(this,s(t).call(this,e,u)),"string"!=typeof e||""===e)throw new Error("host is required");if("undefined"!=typeof WebSocket)o.WebSocketClient=WebSocket,o.options=null;else if(o.WebSocketClient=r(!function(){var e=new Error("Cannot find module 'ws'");throw e.code="MODULE_NOT_FOUND",e}()),o.options={perMessageDeflate:!1,headers:u.headers||null},null!==o.options.headers&&(Array.isArray(o.options.headers)||"object"!==n(o.options.headers)))throw new Error('Invalid "headers" option: expected an object');return o.client=null,o.lasturl=null,o}var a,f,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),a=t,(f=[{key:"connect",value:function(){var e=this;return new Promise(function(r,n){var o="".concat(e.ssl?"wss":"ws","://").concat(e.host,":").concat(e.port);u(s(t.prototype),"connect",e).call(e),o!==e.lasturl&&(e.wasConnected=!1,e.lasturl=o),e.client=new e.WebSocketClient(o,e.options),e.client.onopen=function(){return e.clientConnected(),r()},e.client.onclose=function(t,r){var n,o=r;if("number"==typeof t?n=t:(n=t.code,t.reason&&(o=t.reason)),1e3===n)e.clientDisconnected();else if(e.wasConnected){var i=new Error(o);i.status=n,e.clientNetworkError(i)}},e.client.onerror=function(t){var r=t;if(t instanceof Error||(r=t?new Error(t.message||t):new Error("Unexpected error")),e.clientNetworkError(r),[e.client.CLOSING,e.client.CLOSED].indexOf(e.client.readyState)>-1)return n(r)},e.client.onmessage=function(t){var r=JSON.parse(t.data||t);r.room?e.emit(r.room,r):e.emit("discarded",r)}})}},{key:"send",value:function(e){this.client&&this.client.readyState===this.client.OPEN&&this.client.send(JSON.stringify(e))}},{key:"close",value:function(){this.state="offline",this.removeAllListeners(),this.wasConnected=!1,this.client&&this.client.close(),this.client=null,this.stopRetryingToConnect=!0,u(s(t.prototype),"close",this).call(this)}}])&&o(a.prototype,f),d&&o(a,d),t}();e.exports=a},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=r(8),a=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=i(this,s(t).call(this,e,n)),"string"!=typeof e||""===e)throw new Error("host is required");return r.socket=null,r.forceDisconnect=!1,r.eventsWrapper={},r}var r,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),r=t,(n=[{key:"connect",value:function(){var e=this;return new Promise(function(r,n){u(s(t.prototype),"connect",e).call(e),e.socket=window.io((e.ssl?"https://":"http://")+e.host+":"+e.port,{reconnection:e.autoReconnect,reconnectionDelay:e.reconnectionDelay,forceNew:!0}),e.socket.on("connect",function(){return r(e.clientConnected())}),e.socket.on("connect_error",function(t){e.clientNetworkError(t),n(t)}),e.socket.on("disconnect",function(){if(e.forceDisconnect)e.clientDisconnected();else{var t=new Error("An error occurred, kuzzle may not be ready yet");t.status=500,e.clientNetworkError(t),n(t)}e.forceDisconnect=!1})})}},{key:"addListener",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._addEventWrapper(e,r,n),u(s(t.prototype),"addListener",this).call(this,e,r,n),this}},{key:"prependListener",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._addEventWrapper(e,r,n),u(s(t.prototype),"prependListener",this).call(this,e,r,n)}},{key:"removeListener",value:function(e,r){return this.eventsWrapper[e]&&(this.eventsWrapper[e].listeners.delete(r),0===this.eventsWrapper[e].listeners.size&&(this.socket.off(e,this.eventsWrapper[e].wrapper),delete this.eventsWrapper[e]),u(s(t.prototype),"removeListener",this).call(this,e,r)),this}},{key:"removeAllListeners",value:function(e){if(void 0!==e){if(void 0!==this.eventsWrapper[e])for(var t=0,r=this.eventsWrapper[e].listeners;t<r.length;t++){var n=r[t];this.removeListener(e,n)}}else for(var o=0,i=Object.keys(this.eventsWrapper);o<i.length;o++){var u=i[o];this.removeAllListeners(u)}return this}},{key:"send",value:function(e){this.socket.emit("kuzzle",e)}},{key:"close",value:function(){this.forceDisconnect=!0,this.state="offline",this.socket.close(),this.socket=null,u(s(t.prototype),"close",this).call(this)}},{key:"_addEventWrapper",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.eventsWrapper[e]){var o=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r.emit.apply(r,[e].concat(n))};this.eventsWrapper[e]={wrapper:o,listeners:new Set},-1===["connect","connect_error","disconnect"].indexOf(e)&&(n?this.socket.once(e,o):this.socket.on(e,o))}this.eventsWrapper[e].listeners.add(t)}}])&&o(r.prototype,n),a&&o(r,a),t}();e.exports=a}])});
//# sourceMappingURL=kuzzle.js.map